<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="DeployForge.App.Views.AnalyzePage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:DeployForge.App.Views">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <Border Style="{StaticResource CardStyle}" Margin="0,0,0,24">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                
                <StackPanel Spacing="8">
                    <TextBlock Text="Image Analysis" Style="{StaticResource SubtitleTextBlockStyle}"/>
                    
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBox Text="{x:Bind ViewModel.ImagePath, Mode=TwoWay}"
                                 PlaceholderText="Select a Windows image to analyze..."
                                 IsReadOnly="True"/>
                        <Button Grid.Column="1" Content="Browse" Margin="8,0,0,0"
                                Command="{x:Bind ViewModel.BrowseImageCommand}"/>
                    </Grid>
                </StackPanel>
                
                <StackPanel Grid.Column="1" Orientation="Horizontal" Spacing="8" VerticalAlignment="Bottom">
                    <Button Content="Analyze" Style="{StaticResource AccentButtonStyle}"
                            Command="{x:Bind ViewModel.AnalyzeImageCommand}"
                            IsEnabled="{x:Bind ViewModel.IsAnalyzing, Mode=OneWay, Converter={StaticResource InverseBoolConverter}}"/>
                    <Button Content="Export Report" Command="{x:Bind ViewModel.ExportReportCommand}"/>
                </StackPanel>
            </Grid>
        </Border>
        
        <!-- Analysis Results -->
        <Grid Grid.Row="1">
            <!-- Loading State -->
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="16"
                        Visibility="{x:Bind ViewModel.IsAnalyzing, Mode=OneWay}">
                <ProgressRing IsActive="True" Width="64" Height="64"/>
                <TextBlock Text="Analyzing image..." Style="{StaticResource BodyTextBlockStyle}"/>
            </StackPanel>
            
            <!-- Results -->
            <Pivot Visibility="{x:Bind ViewModel.AnalysisResult, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}">
                <PivotItem Header="Overview">
                    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="0,16,0,0">
                        <StackPanel Spacing="16">
                            <Border Style="{StaticResource CardStyle}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <StackPanel HorizontalAlignment="Center">
                                        <TextBlock Text="{x:Bind ViewModel.AnalysisResult.PackageCount, Mode=OneWay}"
                                                   Style="{StaticResource TitleLargeTextBlockStyle}" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Packages" Style="{StaticResource CaptionTextBlockStyle}"
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                                        <TextBlock Text="{x:Bind ViewModel.AnalysisResult.DriverCount, Mode=OneWay}"
                                                   Style="{StaticResource TitleLargeTextBlockStyle}" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Drivers" Style="{StaticResource CaptionTextBlockStyle}"
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Column="2" HorizontalAlignment="Center">
                                        <TextBlock Text="{x:Bind ViewModel.AnalysisResult.FeatureCount, Mode=OneWay}"
                                                   Style="{StaticResource TitleLargeTextBlockStyle}" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Features" Style="{StaticResource CaptionTextBlockStyle}"
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    </StackPanel>
                                    
                                    <StackPanel Grid.Column="3" HorizontalAlignment="Center">
                                        <TextBlock Text="{x:Bind ViewModel.AnalysisResult.LanguageCount, Mode=OneWay}"
                                                   Style="{StaticResource TitleLargeTextBlockStyle}" HorizontalAlignment="Center"/>
                                        <TextBlock Text="Languages" Style="{StaticResource CaptionTextBlockStyle}"
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    </StackPanel>
                                </Grid>
                            </Border>
                            
                            <Border Style="{StaticResource CardStyle}">
                                <StackPanel Spacing="8">
                                    <TextBlock Text="Image Information" Style="{StaticResource BodyStrongTextBlockStyle}"/>
                                    
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="150"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        
                                        <TextBlock Text="Name:" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                        <TextBlock Grid.Column="1" Text="{x:Bind ViewModel.ImageInfo.Name, Mode=OneWay}"/>
                                        
                                        <TextBlock Grid.Row="1" Text="Format:" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                        <TextBlock Grid.Row="1" Grid.Column="1" Text="{x:Bind ViewModel.ImageInfo.Format, Mode=OneWay}"/>
                                        
                                        <TextBlock Grid.Row="2" Text="Size:" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                        <TextBlock Grid.Row="2" Grid.Column="1" Text="{x:Bind ViewModel.ImageInfo.Size, Mode=OneWay, Converter={StaticResource FileSizeConverter}}"/>
                                        
                                        <TextBlock Grid.Row="3" Text="Modified:" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                        <TextBlock Grid.Row="3" Grid.Column="1" Text="{x:Bind ViewModel.ImageInfo.ModifiedDate, Mode=OneWay}"/>
                                    </Grid>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </PivotItem>
                
                <PivotItem Header="Packages">
                    <ListView ItemsSource="{x:Bind ViewModel.InstalledPackages}" Margin="0,16,0,0">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Grid Padding="8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="100"/>
                                        <ColumnDefinition Width="80"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <TextBlock Text="{Binding Name}"/>
                                    <TextBlock Grid.Column="1" Text="{Binding Version}" 
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock Grid.Column="2" Text="{Binding State}"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </PivotItem>
                
                <PivotItem Header="Drivers">
                    <ListView ItemsSource="{x:Bind ViewModel.InstalledDrivers}" Margin="0,16,0,0">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Grid Padding="8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="150"/>
                                        <ColumnDefinition Width="100"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <TextBlock Text="{Binding Name}"/>
                                    <TextBlock Grid.Column="1" Text="{Binding Provider}" 
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                    <TextBlock Grid.Column="2" Text="{Binding Version}"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </PivotItem>
                
                <PivotItem Header="Features">
                    <ListView ItemsSource="{x:Bind ViewModel.WindowsFeatures}" Margin="0,16,0,0">
                        <ListView.ItemTemplate>
                            <DataTemplate>
                                <Grid Padding="8">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="100"/>
                                    </Grid.ColumnDefinitions>
                                    
                                    <TextBlock Text="{Binding DisplayName}"/>
                                    <TextBlock Grid.Column="1" Text="{Binding State}"
                                               Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </PivotItem>
            </Pivot>
            
            <!-- Empty State -->
            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="16"
                        Visibility="{x:Bind ViewModel.AnalysisResult, Mode=OneWay, Converter={StaticResource NullToInverseVisibilityConverter}}">
                <FontIcon Glyph="&#xE9D9;" FontSize="64" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                <TextBlock Text="Select an image and click Analyze to view details" 
                           Style="{StaticResource BodyTextBlockStyle}"
                           Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
            </StackPanel>
        </Grid>
    </Grid>
</Page>
