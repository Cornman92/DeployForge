<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="DeployForge.App.Views.BuildPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:DeployForge.App.Views"
    xmlns:vm="using:DeployForge.App.ViewModels"
    Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="350"/>
        </Grid.ColumnDefinitions>
        
        <!-- Main Content -->
        <ScrollViewer Grid.Column="0" Padding="40">
            <StackPanel MaxWidth="900">
                
                <!-- Header -->
                <Grid Margin="0,0,0,24">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel Grid.Column="0">
                        <TextBlock 
                            Text="Build Configuration" 
                            Style="{StaticResource DeployForgePageHeaderStyle}"
                            Margin="0"/>
                        <TextBlock 
                            Text="Configure your Windows image customizations"
                            Style="{StaticResource DeployForgeSubtitleStyle}"/>
                    </StackPanel>
                    
                    <!-- Mount Controls -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                        <Button 
                            Content="Mount"
                            Command="{x:Bind ViewModel.MountImageCommand}"
                            Margin="0,0,8,0"
                            Visibility="{x:Bind GetVisibility(ViewModel.IsImageMounted, true), Mode=OneWay}"/>
                        <Button 
                            Content="Unmount"
                            Command="{x:Bind ViewModel.UnmountImageCommand}"
                            Visibility="{x:Bind GetVisibility(ViewModel.IsImageMounted, false), Mode=OneWay}"/>
                    </StackPanel>
                </Grid>
                
                <!-- Feature Sections -->
                
                <!-- Gaming Section -->
                <Expander 
                    Style="{StaticResource FeatureExpanderStyle}"
                    IsExpanded="{x:Bind ViewModel.EnableGaming, Mode=OneWay}">
                    <Expander.Header>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <FontIcon Grid.Column="0" Glyph="&#xE7FC;" FontSize="20" Margin="0,0,16,0"/>
                            <StackPanel Grid.Column="1">
                                <TextBlock Text="Gaming Optimization" FontWeight="SemiBold"/>
                                <TextBlock Text="Game mode, network, and performance tweaks" Opacity="0.6" FontSize="12"/>
                            </StackPanel>
                            <ToggleSwitch 
                                Grid.Column="2"
                                IsOn="{x:Bind ViewModel.EnableGaming, Mode=TwoWay}"
                                OnContent=""
                                OffContent=""/>
                        </Grid>
                    </Expander.Header>
                    
                    <StackPanel Margin="40,16,0,0">
                        <ComboBox 
                            Header="Gaming Profile"
                            ItemsSource="{x:Bind ViewModel.GamingProfiles}"
                            SelectedItem="{x:Bind ViewModel.SelectedGamingProfile, Mode=TwoWay}"
                            Width="200"/>
                        
                        <ToggleSwitch 
                            Header="Enable Game Mode"
                            IsOn="{x:Bind ViewModel.EnableGameMode, Mode=TwoWay}"
                            Margin="0,16,0,0"/>
                        
                        <ToggleSwitch 
                            Header="Disable Xbox Game Bar"
                            IsOn="{x:Bind ViewModel.DisableGameBar, Mode=TwoWay}"/>
                        
                        <ToggleSwitch 
                            Header="Optimize Network for Gaming"
                            IsOn="{x:Bind ViewModel.OptimizeNetwork, Mode=TwoWay}"/>
                        
                        <ToggleSwitch 
                            Header="Install Gaming Runtimes (DirectX, VC++)"
                            IsOn="{x:Bind ViewModel.InstallRuntimes, Mode=TwoWay}"/>
                    </StackPanel>
                </Expander>
                
                <!-- Debloat Section -->
                <Expander 
                    Style="{StaticResource FeatureExpanderStyle}"
                    IsExpanded="{x:Bind ViewModel.EnableDebloat, Mode=OneWay}">
                    <Expander.Header>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <FontIcon Grid.Column="0" Glyph="&#xE74C;" FontSize="20" Margin="0,0,16,0"/>
                            <StackPanel Grid.Column="1">
                                <TextBlock Text="Debloat &amp; Privacy" FontWeight="SemiBold"/>
                                <TextBlock Text="Remove bloatware and enhance privacy" Opacity="0.6" FontSize="12"/>
                            </StackPanel>
                            <ToggleSwitch 
                                Grid.Column="2"
                                IsOn="{x:Bind ViewModel.EnableDebloat, Mode=TwoWay}"
                                OnContent=""
                                OffContent=""/>
                        </Grid>
                    </Expander.Header>
                    
                    <StackPanel Margin="40,16,0,0">
                        <ComboBox 
                            Header="Debloat Level"
                            ItemsSource="{x:Bind ViewModel.DebloatLevels}"
                            SelectedItem="{x:Bind ViewModel.SelectedDebloatLevel, Mode=TwoWay}"
                            Width="200"/>
                        
                        <ComboBox 
                            Header="Privacy Level"
                            ItemsSource="{x:Bind ViewModel.PrivacyLevels}"
                            SelectedItem="{x:Bind ViewModel.SelectedPrivacyLevel, Mode=TwoWay}"
                            Width="200"
                            Margin="0,16,0,0"/>
                        
                        <ToggleSwitch 
                            Header="Disable Telemetry"
                            IsOn="{x:Bind ViewModel.DisableTelemetry, Mode=TwoWay}"
                            Margin="0,16,0,0"/>
                        
                        <ToggleSwitch 
                            Header="Disable Cortana"
                            IsOn="{x:Bind ViewModel.DisableCortana, Mode=TwoWay}"/>
                    </StackPanel>
                </Expander>
                
                <!-- Developer Environment Section -->
                <Expander 
                    Style="{StaticResource FeatureExpanderStyle}"
                    IsExpanded="{x:Bind ViewModel.EnableDevEnvironment, Mode=OneWay}">
                    <Expander.Header>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <FontIcon Grid.Column="0" Glyph="&#xE943;" FontSize="20" Margin="0,0,16,0"/>
                            <StackPanel Grid.Column="1">
                                <TextBlock Text="Developer Environment" FontWeight="SemiBold"/>
                                <TextBlock Text="Development tools, IDEs, and runtimes" Opacity="0.6" FontSize="12"/>
                            </StackPanel>
                            <ToggleSwitch 
                                Grid.Column="2"
                                IsOn="{x:Bind ViewModel.EnableDevEnvironment, Mode=TwoWay}"
                                OnContent=""
                                OffContent=""/>
                        </Grid>
                    </Expander.Header>
                    
                    <StackPanel Margin="40,16,0,0">
                        <ComboBox 
                            Header="Development Profile"
                            ItemsSource="{x:Bind ViewModel.DevelopmentProfiles}"
                            SelectedItem="{x:Bind ViewModel.SelectedDevProfile, Mode=TwoWay}"
                            Width="200"/>
                        
                        <ToggleSwitch 
                            Header="Enable Developer Mode"
                            IsOn="{x:Bind ViewModel.EnableDeveloperMode, Mode=TwoWay}"
                            Margin="0,16,0,0"/>
                        
                        <ToggleSwitch 
                            Header="Enable WSL 2"
                            IsOn="{x:Bind ViewModel.EnableWSL2, Mode=TwoWay}"/>
                    </StackPanel>
                </Expander>
                
                <!-- Browser Configuration Section -->
                <Expander 
                    Style="{StaticResource FeatureExpanderStyle}"
                    IsExpanded="{x:Bind ViewModel.EnableBrowsers, Mode=OneWay}">
                    <Expander.Header>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <FontIcon Grid.Column="0" Glyph="&#xE774;" FontSize="20" Margin="0,0,16,0"/>
                            <StackPanel Grid.Column="1">
                                <TextBlock Text="Browser Configuration" FontWeight="SemiBold"/>
                                <TextBlock Text="Install and configure web browsers" Opacity="0.6" FontSize="12"/>
                            </StackPanel>
                            <ToggleSwitch 
                                Grid.Column="2"
                                IsOn="{x:Bind ViewModel.EnableBrowsers, Mode=TwoWay}"
                                OnContent=""
                                OffContent=""/>
                        </Grid>
                    </Expander.Header>
                    
                    <StackPanel Margin="40,16,0,0">
                        <ComboBox 
                            Header="Default Browser"
                            ItemsSource="{x:Bind ViewModel.BrowserTypes}"
                            SelectedItem="{x:Bind ViewModel.SelectedDefaultBrowser, Mode=TwoWay}"
                            Width="200"/>
                        
                        <ToggleSwitch 
                            Header="Install Google Chrome"
                            IsOn="{x:Bind ViewModel.InstallChrome, Mode=TwoWay}"
                            Margin="0,16,0,0"/>
                        
                        <ToggleSwitch 
                            Header="Install Mozilla Firefox"
                            IsOn="{x:Bind ViewModel.InstallFirefox, Mode=TwoWay}"/>
                    </StackPanel>
                </Expander>
                
                <!-- UI Customization Section -->
                <Expander 
                    Style="{StaticResource FeatureExpanderStyle}"
                    IsExpanded="{x:Bind ViewModel.EnableUICustomization, Mode=OneWay}">
                    <Expander.Header>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <FontIcon Grid.Column="0" Glyph="&#xE771;" FontSize="20" Margin="0,0,16,0"/>
                            <StackPanel Grid.Column="1">
                                <TextBlock Text="UI Customization" FontWeight="SemiBold"/>
                                <TextBlock Text="Taskbar, Start menu, and visual settings" Opacity="0.6" FontSize="12"/>
                            </StackPanel>
                            <ToggleSwitch 
                                Grid.Column="2"
                                IsOn="{x:Bind ViewModel.EnableUICustomization, Mode=TwoWay}"
                                OnContent=""
                                OffContent=""/>
                        </Grid>
                    </Expander.Header>
                    
                    <StackPanel Margin="40,16,0,0">
                        <ComboBox 
                            Header="UI Profile"
                            ItemsSource="{x:Bind ViewModel.UIProfiles}"
                            SelectedItem="{x:Bind ViewModel.SelectedUIProfile, Mode=TwoWay}"
                            Width="200"/>
                        
                        <ToggleSwitch 
                            Header="Enable Dark Mode"
                            IsOn="{x:Bind ViewModel.EnableDarkMode, Mode=TwoWay}"
                            Margin="0,16,0,0"/>
                        
                        <ToggleSwitch 
                            Header="Disable Widgets"
                            IsOn="{x:Bind ViewModel.DisableWidgets, Mode=TwoWay}"/>
                    </StackPanel>
                </Expander>
                
            </StackPanel>
        </ScrollViewer>
        
        <!-- Build Panel -->
        <Border 
            Grid.Column="1"
            Background="{ThemeResource CardBackgroundFillColorSecondaryBrush}"
            BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
            BorderThickness="1,0,0,0">
            <Grid Padding="24">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                
                <!-- Build Header -->
                <StackPanel Grid.Row="0">
                    <TextBlock 
                        Text="Build"
                        FontSize="20"
                        FontWeight="SemiBold"/>
                    <TextBlock 
                        Text="{x:Bind ViewModel.CurrentProfile.Name, Mode=OneWay}"
                        Opacity="0.6"
                        Margin="0,4,0,0"/>
                </StackPanel>
                
                <!-- Build Progress and Log -->
                <ScrollViewer Grid.Row="1" Margin="0,24,0,24">
                    <StackPanel>
                        <!-- Progress -->
                        <ProgressBar 
                            Value="{x:Bind ViewModel.BuildProgress, Mode=OneWay}"
                            Visibility="{x:Bind GetVisibility(ViewModel.IsBuilding, false), Mode=OneWay}"
                            Margin="0,0,0,8"/>
                        
                        <TextBlock 
                            Text="{x:Bind ViewModel.BuildStatus, Mode=OneWay}"
                            TextWrapping="Wrap"
                            Margin="0,0,0,16"/>
                        
                        <!-- Build Log -->
                        <ItemsControl ItemsSource="{x:Bind ViewModel.BuildLog, Mode=OneWay}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate x:DataType="vm:BuildLogEntry">
                                    <Grid Margin="0,4">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        
                                        <FontIcon 
                                            Grid.Column="0"
                                            Glyph="{x:Bind LevelIcon}"
                                            FontSize="12"
                                            Margin="0,0,8,0"/>
                                        
                                        <TextBlock 
                                            Grid.Column="1"
                                            Text="{x:Bind Message}"
                                            TextWrapping="Wrap"
                                            Style="{StaticResource LogEntryStyle}"/>
                                    </Grid>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </ScrollViewer>
                
                <!-- Build Actions -->
                <StackPanel Grid.Row="2">
                    <Button 
                        Content="Start Build"
                        Style="{StaticResource DeployForgePrimaryButtonStyle}"
                        HorizontalAlignment="Stretch"
                        Command="{x:Bind ViewModel.BuildCommand}"
                        IsEnabled="{x:Bind CanBuild(ViewModel.IsImageMounted, ViewModel.IsBuilding), Mode=OneWay}"/>
                    
                    <Button 
                        Content="Save as Template"
                        HorizontalAlignment="Stretch"
                        Margin="0,8,0,0"
                        Click="SaveTemplate_Click"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Page>
